GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
Initializing distributed: GLOBAL_RANK: 5, MEMBER: 6/10
Initializing distributed: GLOBAL_RANK: 6, MEMBER: 7/10
Initializing distributed: GLOBAL_RANK: 4, MEMBER: 5/10
Initializing distributed: GLOBAL_RANK: 9, MEMBER: 10/10
Initializing distributed: GLOBAL_RANK: 7, MEMBER: 8/10
Initializing distributed: GLOBAL_RANK: 8, MEMBER: 9/10
Initializing distributed: GLOBAL_RANK: 2, MEMBER: 3/10
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/10
Initializing distributed: GLOBAL_RANK: 3, MEMBER: 4/10
Initializing distributed: GLOBAL_RANK: 1, MEMBER: 2/10
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 10 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA A100-PCIE-40GB') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 1 - CUDA_VISIBLE_DEVICES: [0,1]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]

  | Name      | Type        | Params
------------------------------------------
0 | esm_model | ESM2        | 2.8 B 
1 | proj      | Sequential  | 5.1 K 
2 | auroc     | BinaryAUROC | 0     
------------------------------------------
793 M     Trainable params
2.0 B     Non-trainable params
2.8 B     Total params
11,356.043Total estimated model params size (MB)
/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: No positive samples in targets, true positive value should be meaningless. Returning zero tensor in true positive score
  warnings.warn(*args, **kwargs)
/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: No positive samples in targets, true positive value should be meaningless. Returning zero tensor in true positive score
  warnings.warn(*args, **kwargs)
[rank: 5] Metric val_loss improved. New best score: 0.458
[rank: 1] Metric val_loss improved. New best score: 0.458
[rank: 9] Metric val_loss improved. New best score: 0.458
[rank: 2] Metric val_loss improved. New best score: 0.458
[rank: 6] Metric val_loss improved. New best score: 0.458
[rank: 4] Metric val_loss improved. New best score: 0.458
[rank: 0] Metric val_loss improved. New best score: 0.458
[rank: 8] Metric val_loss improved. New best score: 0.458
[rank: 3] Metric val_loss improved. New best score: 0.458
[rank: 7] Metric val_loss improved. New best score: 0.458
Traceback (most recent call last):
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/ESM_finetune_ddp.py", line 85, in <module>
    trainer.fit(model=myesm,datamodule=proData)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 520, in fit
    call._call_and_handle_interrupt(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 42, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/launchers/subprocess_script.py", line 92, in launch
    return function(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 559, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 935, in _run
    results = self._run_stage()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 978, in _run_stage
    self.fit_loop.run()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 201, in run
    self.advance()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 133, in run
    self.advance(data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 218, in advance
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 185, in run
    self._optimizer_step(kwargs.get("batch_idx", 0), closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 261, in _optimizer_step
    call._call_lightning_module_hook(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 142, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/module.py", line 1265, in optimizer_step
    optimizer.step(closure=optimizer_closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/optimizer.py", line 158, in step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 257, in optimizer_step
    optimizer_output = super().optimizer_step(optimizer, closure, model, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/strategy.py", line 224, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 114, in optimizer_step
Traceback (most recent call last):
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/ESM_finetune_ddp.py", line 85, in <module>
    trainer.fit(model=myesm,datamodule=proData)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 520, in fit
    call._call_and_handle_interrupt(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 42, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/launchers/subprocess_script.py", line 92, in launch
Traceback (most recent call last):
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/ESM_finetune_ddp.py", line 85, in <module>
    return function(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 559, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 935, in _run
    results = self._run_stage()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 978, in _run_stage
    return optimizer.step(closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    self.fit_loop.run()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 201, in run
    trainer.fit(model=myesm,datamodule=proData)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 520, in fit
    self.advance()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 133, in run
    self.advance(data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 218, in advance
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], kwargs)
    call._call_and_handle_interrupt(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 42, in _call_and_handle_interrupt
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 185, in run
    self._optimizer_step(kwargs.get("batch_idx", 0), closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 261, in _optimizer_step
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/launchers/subprocess_script.py", line 92, in launch
    call._call_lightning_module_hook(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 142, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/module.py", line 1265, in optimizer_step
    return function(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 559, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 935, in _run
    results = self._run_stage()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 978, in _run_stage
    optimizer.step(closure=optimizer_closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/optimizer.py", line 158, in step
    self.fit_loop.run()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 201, in run
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 257, in optimizer_step
    self.advance()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 133, in run
    optimizer_output = super().optimizer_step(optimizer, closure, model, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/strategy.py", line 224, in optimizer_step
    self.advance(data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 218, in advance
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 185, in run
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 114, in optimizer_step
    self._optimizer_step(kwargs.get("batch_idx", 0), closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 261, in _optimizer_step
    return optimizer.step(closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    call._call_lightning_module_hook(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 142, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/module.py", line 1265, in optimizer_step
    optimizer.step(closure=optimizer_closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/optimizer.py", line 158, in step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 257, in optimizer_step
    optimizer_output = super().optimizer_step(optimizer, closure, model, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/strategy.py", line 224, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 114, in optimizer_step
    return optimizer.step(closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    out = func(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
    out = func(*args, **kwargs)
    out = func(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
    ret = func(self, *args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/adam.py", line 121, in step
    ret = func(self, *args, **kwargs)
    ret = func(self, *args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/adam.py", line 121, in step
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/adam.py", line 121, in step
    loss = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 101, in _wrap_closure
    loss = closure()
    loss = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 101, in _wrap_closure
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 101, in _wrap_closure
    closure_result = closure()
    closure_result = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 140, in __call__
    closure_result = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 140, in __call__
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 140, in __call__
    self._result = self.closure(*args, **kwargs)
    self._result = self.closure(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 126, in closure
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 126, in closure
    self._result = self.closure(*args, **kwargs)
    step_output = self._step_fn()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 126, in closure
    step_output = self._step_fn()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 308, in _training_step
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 308, in _training_step
    step_output = self._step_fn()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 308, in _training_step
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 288, in _call_strategy_hook
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 288, in _call_strategy_hook
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 288, in _call_strategy_hook
    output = fn(*args, **kwargs)
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 329, in training_step
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 329, in training_step
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 329, in training_step
    return self.model(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return self.model(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return self.model(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    output = self._run_ddp_forward(*inputs, **kwargs)
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/overrides/base.py", line 90, in forward
    return forward_call(*args, **kwargs)
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/overrides/base.py", line 90, in forward
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/overrides/base.py", line 90, in forward
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 360, in training_step
    output = self._forward_module.training_step(*inputs, **kwargs)
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 360, in training_step
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 360, in training_step
    sequence_representations=self.train_mul_gpu(batch_tokens)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 437, in train_mul_gpu
    sequence_representations=self.train_mul_gpu(batch_tokens)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 437, in train_mul_gpu
    sequence_representations=self.train_mul_gpu(batch_tokens)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 437, in train_mul_gpu
    results = self.esm_model(batch_tokens, repr_layers=[self.repr_layers], return_contacts=False)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    results = self.esm_model(batch_tokens, repr_layers=[self.repr_layers], return_contacts=False)
    results = self.esm_model(batch_tokens, repr_layers=[self.repr_layers], return_contacts=False)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/model/esm2.py", line 112, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/model/esm2.py", line 112, in forward
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/model/esm2.py", line 112, in forward
    x, attn = layer(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    x, attn = layer(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    x, attn = layer(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/modules.py", line 125, in forward
    return forward_call(*args, **kwargs)
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/modules.py", line 125, in forward
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/modules.py", line 125, in forward
    x, attn = self.self_attn(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    x, attn = self.self_attn(
    x, attn = self.self_attn(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 379, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 357, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 379, in forward
    attn_weights_float = utils_softmax(attn_weights, dim=-1, onnx_trace=self.onnx_trace)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 22, in utils_softmax
    attn_weights_float = utils_softmax(attn_weights, dim=-1, onnx_trace=self.onnx_trace)
    attn_weights = torch.bmm(q, k.transpose(1, 2))
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 324.00 MiB (GPU 1; 39.42 GiB total capacity; 37.27 GiB already allocated; 133.19 MiB free; 38.01 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 22, in utils_softmax
    return F.softmax(x, dim=dim, dtype=torch.float32)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/functional.py", line 1845, in softmax
    return F.softmax(x, dim=dim, dtype=torch.float32)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/functional.py", line 1845, in softmax
    ret = input.softmax(dim, dtype=dtype)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 296.00 MiB (GPU 1; 39.42 GiB total capacity; 37.69 GiB already allocated; 47.25 MiB free; 38.09 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
    ret = input.softmax(dim, dtype=dtype)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 328.00 MiB (GPU 1; 39.42 GiB total capacity; 36.48 GiB already allocated; 73.25 MiB free; 38.07 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
srun: error: g023: task 5: Exited with exit code 1
srun: error: g037: task 9: Exited with exit code 1
srun: error: g022: task 3: Exited with exit code 1
/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: No positive samples in targets, true positive value should be meaningless. Returning zero tensor in true positive score
  warnings.warn(*args, **kwargs)
/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: No positive samples in targets, true positive value should be meaningless. Returning zero tensor in true positive score
  warnings.warn(*args, **kwargs)
[rank: 6] Metric val_loss improved. New best score: 0.458
[rank: 2] Metric val_loss improved. New best score: 0.458
[rank: 5] Metric val_loss improved. New best score: 0.458
[rank: 0] Metric val_loss improved. New best score: 0.458
[rank: 7] Metric val_loss improved. New best score: 0.458
[rank: 3] Metric val_loss improved. New best score: 0.458
[rank: 4] Metric val_loss improved. New best score: 0.458
[rank: 1] Metric val_loss improved. New best score: 0.458
[rank: 8] Metric val_loss improved. New best score: 0.458
[rank: 9] Metric val_loss improved. New best score: 0.458
Traceback (most recent call last):
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/ESM_finetune_ddp.py", line 85, in <module>
Traceback (most recent call last):
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/ESM_finetune_ddp.py", line 85, in <module>
    trainer.fit(model=myesm,datamodule=proData)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 520, in fit
Traceback (most recent call last):
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/ESM_finetune_ddp.py", line 85, in <module>
    trainer.fit(model=myesm,datamodule=proData)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 520, in fit
    call._call_and_handle_interrupt(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 42, in _call_and_handle_interrupt
    trainer.fit(model=myesm,datamodule=proData)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 520, in fit
    call._call_and_handle_interrupt(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 42, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/launchers/subprocess_script.py", line 92, in launch
    call._call_and_handle_interrupt(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 42, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/launchers/subprocess_script.py", line 92, in launch
    return function(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 559, in _fit_impl
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/launchers/subprocess_script.py", line 92, in launch
    return function(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 559, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 935, in _run
    return function(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 559, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 935, in _run
    results = self._run_stage()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 978, in _run_stage
    self._run(model, ckpt_path=ckpt_path)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 935, in _run
    results = self._run_stage()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 978, in _run_stage
    self.fit_loop.run()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 201, in run
    results = self._run_stage()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/trainer.py", line 978, in _run_stage
    self.fit_loop.run()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 201, in run
    self.fit_loop.run()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 201, in run
    self.advance()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 354, in advance
    self.advance()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 354, in advance
    self.advance()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/fit_loop.py", line 354, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 133, in run
    self.epoch_loop.run(self._data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 133, in run
    self.epoch_loop.run(self._data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 133, in run
    self.advance(data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 218, in advance
    self.advance(data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 218, in advance
    self.advance(data_fetcher)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/training_epoch_loop.py", line 218, in advance
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 185, in run
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 185, in run
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 185, in run
    self._optimizer_step(kwargs.get("batch_idx", 0), closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 261, in _optimizer_step
    self._optimizer_step(kwargs.get("batch_idx", 0), closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 261, in _optimizer_step
    self._optimizer_step(kwargs.get("batch_idx", 0), closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 261, in _optimizer_step
    call._call_lightning_module_hook(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 142, in _call_lightning_module_hook
    call._call_lightning_module_hook(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 142, in _call_lightning_module_hook
    call._call_lightning_module_hook(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 142, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/module.py", line 1265, in optimizer_step
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/module.py", line 1265, in optimizer_step
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/module.py", line 1265, in optimizer_step
    optimizer.step(closure=optimizer_closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/optimizer.py", line 158, in step
    optimizer.step(closure=optimizer_closure)
    optimizer.step(closure=optimizer_closure)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/optimizer.py", line 158, in step
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/core/optimizer.py", line 158, in step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 257, in optimizer_step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 257, in optimizer_step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 257, in optimizer_step
    optimizer_output = super().optimizer_step(optimizer, closure, model, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/strategy.py", line 224, in optimizer_step
    optimizer_output = super().optimizer_step(optimizer, closure, model, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/strategy.py", line 224, in optimizer_step
    optimizer_output = super().optimizer_step(optimizer, closure, model, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/strategy.py", line 224, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 114, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 114, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 114, in optimizer_step
    return optimizer.step(closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    return optimizer.step(closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    return optimizer.step(closure=closure, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    out = func(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
    out = func(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
    out = func(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
    ret = func(self, *args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/adam.py", line 121, in step
    ret = func(self, *args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/adam.py", line 121, in step
    ret = func(self, *args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/optim/adam.py", line 121, in step
    loss = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 101, in _wrap_closure
    loss = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 101, in _wrap_closure
    loss = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/plugins/precision/precision_plugin.py", line 101, in _wrap_closure
    closure_result = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 140, in __call__
    closure_result = closure()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 140, in __call__
    closure_result = closure()
    self._result = self.closure(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 126, in closure
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 140, in __call__
    self._result = self.closure(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 126, in closure
    step_output = self._step_fn()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 308, in _training_step
    self._result = self.closure(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 126, in closure
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 288, in _call_strategy_hook
    step_output = self._step_fn()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 308, in _training_step
    step_output = self._step_fn()
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/loops/optimization/automatic.py", line 308, in _training_step
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 288, in _call_strategy_hook
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/trainer/call.py", line 288, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 329, in training_step
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 329, in training_step
    output = fn(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/strategies/ddp.py", line 329, in training_step
    return self.model(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return self.model(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return self.model(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
    return forward_call(*args, **kwargs)
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1156, in forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    output = self._run_ddp_forward(*inputs, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1110, in _run_ddp_forward
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return module_to_run(*inputs[0], **kwargs[0])  # type: ignore[index]
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/overrides/base.py", line 90, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/overrides/base.py", line 90, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/lightning/pytorch/overrides/base.py", line 90, in forward
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 360, in training_step
    output = self._forward_module.training_step(*inputs, **kwargs)
    output = self._forward_module.training_step(*inputs, **kwargs)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 360, in training_step
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 360, in training_step
    sequence_representations=self.train_mul_gpu(batch_tokens)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 437, in train_mul_gpu
    sequence_representations=self.train_mul_gpu(batch_tokens)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 437, in train_mul_gpu
    sequence_representations=self.train_mul_gpu(batch_tokens)
  File "/scratch/user/zshuying/ppi_mutation/scripts/myesm/model.py", line 437, in train_mul_gpu
    results = self.esm_model(batch_tokens, repr_layers=[self.repr_layers], return_contacts=False)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    results = self.esm_model(batch_tokens, repr_layers=[self.repr_layers], return_contacts=False)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    results = self.esm_model(batch_tokens, repr_layers=[self.repr_layers], return_contacts=False)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/model/esm2.py", line 112, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/model/esm2.py", line 112, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/model/esm2.py", line 112, in forward
    x, attn = layer(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    x, attn = layer(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    x, attn = layer(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/modules.py", line 125, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/modules.py", line 125, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/modules.py", line 125, in forward
    x, attn = self.self_attn(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    x, attn = self.self_attn(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    x, attn = self.self_attn(
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 357, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 379, in forward
    return forward_call(*args, **kwargs)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 379, in forward
    attn_weights_float = utils_softmax(attn_weights, dim=-1, onnx_trace=self.onnx_trace)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 22, in utils_softmax
    attn_weights = torch.bmm(q, k.transpose(1, 2))
    attn_weights_float = utils_softmax(attn_weights, dim=-1, onnx_trace=self.onnx_trace)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/esm/multihead_attention.py", line 22, in utils_softmax
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 324.00 MiB (GPU 1; 39.42 GiB total capacity; 37.27 GiB already allocated; 131.25 MiB free; 38.01 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
    return F.softmax(x, dim=dim, dtype=torch.float32)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/functional.py", line 1845, in softmax
    return F.softmax(x, dim=dim, dtype=torch.float32)
  File "/scratch/user/zshuying/.conda/envs/yuning/lib/python3.9/site-packages/torch/nn/functional.py", line 1845, in softmax
    ret = input.softmax(dim, dtype=dtype)
    ret = input.softmax(dim, dtype=dtype)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 296.00 MiB (GPU 1; 39.42 GiB total capacity; 37.69 GiB already allocated; 47.19 MiB free; 38.09 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 328.00 MiB (GPU 1; 39.42 GiB total capacity; 36.48 GiB already allocated; 73.19 MiB free; 38.07 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
srun: error: g043: task 5: Exited with exit code 1
srun: error: g045: task 9: Exited with exit code 1
srun: error: g030: task 3: Exited with exit code 1
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
slurmstepd: error: *** STEP 8446736.0 ON g029 CANCELLED AT 2023-06-14T13:28:11 DUE TO TIME LIMIT ***
slurmstepd: error: *** JOB 8446736 ON g029 CANCELLED AT 2023-06-14T13:28:11 DUE TO TIME LIMIT ***
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
slurmstepd: error: *** STEP 8447811.0 ON g019 CANCELLED AT 2023-06-14T17:51:26 DUE TO TIME LIMIT ***
slurmstepd: error: *** JOB 8447811 ON g019 CANCELLED AT 2023-06-14T17:51:26 DUE TO TIME LIMIT ***
